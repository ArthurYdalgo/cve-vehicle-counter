# Vehicle Counter

YOLOv3 implementation to count cars and motorcycles that pass through a designated area

# Step-by-step installation

### Clone the repo or download it as a .zip file, and then unzip it
    $ git clone https://github.com/ArthurYdalgo/cve-vehicle-counter

### Once inside the repo folder
    $ sudo chmod +x setup.sh
    $ ./setup.sh

### Execute
    $ ./main.py

Alternatively, the LaneCounter can be used as desired importing the laneCouter, declating a LaneCounter and running the 'count()' method, which will return a dictionary containing the result of each counted class

    $ import laneCounter as lc
    $ lane_counter = lc.LaneCounter()
    $ counter = lane_counter.count()


# Changing parameters
## Footage source
The source is, as default, the 'road footage.mp4' file. In case a different source is desired, add a 'footage_source' paramenter in the LaneCounter declaration in 'main.py'

    $ lane_counter = lc.LaneCounter(footage_source='another footage.mp4')

or send an integer if the source is a connected device. To use your webcam, use 0 as paramenter

    $ lane_counter = lc.LaneCounter(footage_source=0)

## Targets
In case other set of targets is desired, such as cars, boats, motorbikes and trucks, add a 'look_for' parameter in the LaneCounter declaration in 'main.py'. This will be the new list of targets, overwriting the default one (car and motorbike). The complete list of available targets in the coco.names file. Be aware that in case too many targets are set and 'crop' is set to True, not all targets counters will fit inside the footage

    $ lane_counter = lc.LaneCounter(look_for=['car','truck'])

## Thresholds
Two thresholds can be overwritten, if desired. The 'confidence_threshold' and the 'nms_threshold', which are, by default, 0.5 and 0.3 respectively. Simply add the desired parameters in the LaneCounter declaration in 'main.py'.

    $ lane_counter = lc.LaneCounter(confidence_threshold=0.7, nms_threshold=0.1)

## Search area and cropping
The third lane (from the footage camera's perspective, starting from the left) is the default search area. In case a new area is desired, add a 'search_area' parameter in the LaneCounter declaration in 'main.py', which is a dictionary containing the x and y center of the search area, and it's dimensions (width and height)

    $ x, y, width, height = 715, 475, 150, 35
    $ desired_area = {'position': (x, y), 'dimension': (width, height)}
    $ lane_counter = lc.LaneCounter(search_area = desired_area)

The footage is cropped around the search area by default with a 100 pixels margin, to disable that, add the 'crop' parameter in the LaneCounter declaration in 'main.py'

    $ lane_counter = lc.LaneCounter(crop=False)
